var runtime_engine = `<!DOCTYPE html><html> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>GAME</title> <script> var header=function(){};var roomLabels={};var preserveMap=[];var room="0,0,0";var north="north";var south="south";var east="east";var west="west";var northeast="northeast";var northwest="northwest";var southeast="southeast";var southwest="southwest";var up="up";var down="down";var roomObjects=[];var inventoryObjects=[];var statistics=[];window.pl={};window.definitions={};var drawnPositions;var drawnLines;var allowedLines;var gridSize;var roomSize;var mapWidth;var mapCenterY;var mapCenterX;var opacity=0;var fontSize=1.3;var hypcntr=0;var ornt="";var saveSlots=[];function onGameLoad(){if(window.innerHeight>window.innerWidth){ornt="portrait"}else{ornt="landscape"}if(localStorage.getItem("fontSize")!==null){fontSize=localStorage.getItem("fontSize")}if(localStorage.getItem("saveSlots")!==null){saveSlots=JSON.parse(localStorage.getItem("saveSlots"))}window.dom_mask=document.getElementById("mask");window.dom_scene=document.getElementById("scene");window.game_btn=document.getElementById("game_btn");window.map_btn=document.getElementById("map_btn");window.stats_btn=document.getElementById("stats_btn");window.settings_btn=document.getElementById("settings_btn");window.dom_map=document.getElementById("map");window.dom_tabs=document.getElementById("tabs");window.buttons=document.getElementsByClassName("button");window.dom_sidePanel=document.getElementById("sidePanel");window.north_arrow=document.getElementById("north");window.south_arrow=document.getElementById("south");window.east_arrow=document.getElementById("east");window.west_arrow=document.getElementById("west");window.northwest_arrow=document.getElementById("northwest");window.northeast_arrow=document.getElementById("northeast");window.southwest_arrow=document.getElementById("southwest");window.southeast_arrow=document.getElementById("southeast");window.up_arrow=document.getElementById("up");window.down_arrow=document.getElementById("down");window.dom_zCounter=document.getElementById("zCounter");dom_scene.style.fontSize=fontSize+"em";if(ornt==="portrait"){if(localStorage.getItem("opacity")!==null){opacity=localStorage.getItem("opacity")}dom_map.style.opacity=opacity;game_btn.classList.toggle("active_bottom_btn");dom_map.style.opacity=opacity;dom_map.style.pointerEvents="none";game_btn.addEventListener("click",function(){switchView("game")})}else{document.getElementById("container").style.width="calc(50% + 4px)";document.getElementById("container").style.left="calc(50% - 4px)";var newPanel=document.createElement("DIV");newPanel.id="newPanel";document.body.appendChild(newPanel);newPanel.appendChild(dom_scene);dom_scene.style.height="calc(100% - 16px)";dom_scene.style.width="calc(100% - 8px)";dom_scene.style.borderBottomLeftRadius="16px";dom_scene.style.borderTopLeftRadius="16px";dom_map.style.opacity=1;document.getElementById("shadow").style.borderTopLeftRadius=0;document.getElementById("shadow").style.borderBottomLeftRadius=0;map_btn.classList.toggle("active_bottom_btn");dom_map.style.opacity=1;game_btn.innerHTML="<span style='text-decoration: line-through'>Console</span>"}map_btn.addEventListener("click",function(){switchView("map")});stats_btn.addEventListener("click",function(){switchView("stats")});settings_btn.addEventListener("click",function(){switchView("settings")});function switchView(string){function switchOffOtherButtons(element){var bottom_buttons=dom_tabs.children;for(var i=0;i<bottom_buttons.length;i+=1){if(bottom_buttons[i]!==element){bottom_buttons[i].classList.remove("active_bottom_btn")}}};if(string==="game"&&!(game_btn.classList.contains("active_bottom_btn"))){if(document.getElementById("opacitySlider")!==null){opacity=document.getElementById("opacitySlider").value;localStorage.setItem("opacity",opacity)}game_btn.classList.toggle("active_bottom_btn");dom_map.style.backgroundColor="transparent";dom_map.style.opacity=opacity;dom_map.style.pointerEvents="none";dom_mask.style.visibility="hidden";switchOffOtherButtons(game_btn)}else if(string==="map"&&!(map_btn.classList.contains("active_bottom_btn"))){map_btn.classList.toggle("active_bottom_btn");dom_map.style.opacity="1";dom_map.style.pointerEvents="auto";dom_mask.style.visibility="hidden";switchOffOtherButtons(map_btn)}else if(string==="stats"&&!(stats_btn.classList.contains("active_bottom_btn"))){updateStats();dom_mask.style.visibility="visible";stats_btn.classList.toggle("active_bottom_btn");switchOffOtherButtons(stats_btn)}else if(string==="settings"&&!(settings_btn.classList.contains("active_bottom_btn"))){showSettings();dom_mask.style.visibility="visible";settings_btn.classList.toggle("active_bottom_btn");switchOffOtherButtons(settings_btn)}};document.getElementById("surroundings_btn").addEventListener("click",function(){this.classList.toggle("buttonActive");if(this.classList.contains("buttonActive")){dom_sidePanel.innerHTML="";changeItemsInPanel(this);dom_sidePanel.style.right="0";document.getElementById("inventory_btn").classList.remove("buttonActive")}else{dom_sidePanel.style.right="-70%"}});document.getElementById("inventory_btn").addEventListener("click",function(){this.classList.toggle("buttonActive");if(this.classList.contains("buttonActive")){dom_sidePanel.innerHTML="";changeItemsInPanel(this);dom_sidePanel.style.right="0";document.getElementById("surroundings_btn").classList.remove("buttonActive")}else{dom_sidePanel.style.right="-70%"}});gridSize=1001;roomSize=64;mapWidth=gridSize*roomSize;mapCenterY="calc(50% - "+(0.5*mapWidth)+"px)";mapCenterX="calc((0.5 * (100% - 208px - 45px)) - "+(0.5*mapWidth)+"px)";var map=dom_map;dom_map.style.width=mapWidth+"px";dom_map.style.height=mapWidth+"px";dom_map.style.top=mapCenterX;dom_map.style.left=mapCenterY;drawnPositions=[room];drawnLines=[];allowedLines=[];drawSquare([0,0,0]);var circle=document.createElement("DIV");circle.id="blob";var coords=room.split(",");document.getElementById("square("+coords[0]+","+coords[1]+","+coords[2]+")").appendChild(circle);function move(directions){var playerPosition=room.split(",");for(var i=0;i<playerPosition.length;i+=1){playerPosition[i]=parseInt(playerPosition[i])}if(directions[0]!==0){playerPosition[0]+=directions[0];dom_map.style.left="calc(50% - "+((0.5*mapWidth)+(playerPosition[0]*roomSize*2))+"px)";if(drawnPositions.indexOf(playerPosition[0]+","+playerPosition[1]+","+playerPosition[2])===-1){if(directions[1]===0){drawSquare(playerPosition);drawnPositions.push(playerPosition[0]+","+playerPosition[1]+","+playerPosition[2])}}}if(directions[1]!==0){playerPosition[1]+=directions[1];dom_map.style.top="calc((0.5 * (100% - 208px - 45px)) - "+((0.5*mapWidth)-(playerPosition[1]*roomSize*2))+"px)";if(drawnPositions.indexOf(playerPosition[0]+","+playerPosition[1]+","+playerPosition[2])===-1){drawSquare(playerPosition);drawnPositions.push(playerPosition[0]+","+playerPosition[1]+","+playerPosition[2])}}room=playerPosition[0]+","+playerPosition[1]+","+playerPosition[2]};north_arrow.addEventListener("click",function(){if(this.classList.contains("directionAvailable")){move([0,1,0]);allowedLines.push(room+",vertical");drawLines();removeArrowColorings(this,"")}});south_arrow.addEventListener("click",function(){if(this.classList.contains("directionAvailable")){allowedLines.push(room+",vertical");move([0,-1,0]);drawLines();removeArrowColorings(this,"")}});east_arrow.addEventListener("click",function(){if(this.classList.contains("directionAvailable")){allowedLines.push(room+",horizontal");move([1,0,0]);drawLines();removeArrowColorings(this,"")}});west_arrow.addEventListener("click",function(){if(this.classList.contains("directionAvailable")){move([-1,0,0]);allowedLines.push(room+",horizontal");drawLines();removeArrowColorings(this,"")}});northwest_arrow.parentNode.addEventListener("click",function(){if(this.children[0].classList.contains("directionAvailable")){allowedLines.push(room+",downhill");move([-1,1,0]);drawLines();removeArrowColorings(this.children[0],"")}});northeast_arrow.parentNode.addEventListener("click",function(){if(this.children[0].classList.contains("directionAvailable")){allowedLines.push(room+",uphill");move([1,1,0]);drawLines();removeArrowColorings(this.children[0],"")}});southwest_arrow.parentNode.addEventListener("click",function(){if(this.children[0].classList.contains("directionAvailable")){move([-1,-1,0]);allowedLines.push(room+",uphill");drawLines();removeArrowColorings(this.children[0],"")}});southeast_arrow.parentNode.addEventListener("click",function(){if(this.children[0].classList.contains("directionAvailable")){move([1,-1,0]);allowedLines.push(room+",downhill");drawLines();removeArrowColorings(this.children[0],"")}});up_arrow.addEventListener("click",function(){if(this.classList.contains("directionAvailable")){changeMapLayer(1);removeArrowColorings(this,"don't remove")}});down_arrow.addEventListener("click",function(){if(this.classList.contains("directionAvailable")){changeMapLayer(-1);removeArrowColorings(this,"don't remove")}});header();try{definitions[room]()}catch(error){print(error)}};function drawSquare(coords){var square=document.createElement("DIV");square.classList.add("mapRoom");square.id="square("+coords[0]+","+coords[1]+","+coords[2]+")";square.style.left=(Math.floor(0.5*mapWidth)-(0.5*roomSize)+(coords[0]*roomSize*2))+"px";square.style.top=(Math.floor(0.5*mapWidth)-(0.5*roomSize)-(coords[1]*roomSize*2))+"px";if(roomLabels[square.id]!==undefined){square.innerHTML=roomLabels[square.id]}else{square.innerHTML=""}dom_map.appendChild(square)};function drawLines(){for(var i=0;i<drawnPositions.length;i+=1){var currentPositionToAnalyse=drawnPositions[i].split(",");for(var j=0;j<currentPositionToAnalyse.length;j+=1){currentPositionToAnalyse[j]=parseInt(currentPositionToAnalyse[j])}var squareBelow=drawnPositions[i].split(",");squareBelow[1]=parseInt(squareBelow[1])-1;var squareBelow_string=squareBelow[0]+","+squareBelow[1]+","+squareBelow[2];if(drawnPositions.indexOf(squareBelow_string)!==-1&&drawnLines.indexOf(drawnPositions[i]+",vertical")===-1&&allowedLines.indexOf(drawnPositions[i]+",vertical")!==-1){var line=document.createElement("DIV");line.classList.add("verticalLine");line.style.left=(Math.floor(0.5*mapWidth)-(0.5*roomSize)+(currentPositionToAnalyse[0]*roomSize*2))+"px";line.style.top=(Math.floor(0.5*mapWidth)-(0.5*roomSize)-(currentPositionToAnalyse[1]*roomSize*2)+(roomSize))+"px";dom_map.appendChild(line);drawnLines.push(drawnPositions[i]+",vertical")}var squareRight=drawnPositions[i].split(",");squareRight[0]=parseInt(squareRight[0])+1;var squareRight_string=squareRight[0]+","+squareRight[1]+","+squareRight[2];if(drawnPositions.indexOf(squareRight_string)!==-1&&drawnLines.indexOf(drawnPositions[i]+",horizontal")===-1&&allowedLines.indexOf(drawnPositions[i]+",horizontal")!==-1){var line=document.createElement("DIV");line.classList.add("horizontalLine");line.style.left=(Math.floor(0.5*mapWidth)-(0.5*roomSize)+(currentPositionToAnalyse[0]*roomSize*2)+(roomSize))+"px";line.style.top=(Math.floor(0.5*mapWidth)-(0.5*roomSize)-(currentPositionToAnalyse[1]*roomSize*2))+"px";dom_map.appendChild(line);drawnLines.push(drawnPositions[i]+",horizontal")}var squareNE=drawnPositions[i].split(",");squareNE[0]=parseInt(squareNE[0])+1;squareNE[1]=parseInt(squareNE[1])+1;var squareNE_string=squareNE[0]+","+squareNE[1]+","+squareNE[2];if(drawnPositions.indexOf(squareNE_string)!==-1&&drawnLines.indexOf(drawnPositions[i]+",uphill")===-1&&allowedLines.indexOf(drawnPositions[i]+",uphill")!==-1){var lineContainer=document.createElement("DIV");lineContainer.classList.add("uphillLineContainer");lineContainer.style.left=(Math.floor(0.5*mapWidth)-(0.5*roomSize)+(currentPositionToAnalyse[0]*roomSize*2)+(roomSize))+"px";lineContainer.style.top=(Math.floor(0.5*mapWidth)-(0.5*roomSize)-(currentPositionToAnalyse[1]*roomSize*2)-(roomSize))+"px";dom_map.appendChild(lineContainer);var line=document.createElement("DIV");line.classList.add("diagonalLine");line.classList.add("uphillLine");lineContainer.appendChild(line);drawnLines.push(drawnPositions[i]+",uphill")}var squareNW=drawnPositions[i].split(",");squareNW[0]=parseInt(squareNW[0])-1;squareNW[1]=parseInt(squareNW[1])+1;var squareNW_string=squareNW[0]+","+squareNW[1]+","+squareNW[2];if(drawnPositions.indexOf(squareNW_string)!==-1&&drawnLines.indexOf(drawnPositions[i]+",downhill")===-1&&allowedLines.indexOf(drawnPositions[i]+",downhill")!==-1){var lineContainer=document.createElement("DIV");lineContainer.classList.add("uphillLineContainer");lineContainer.style.left=(Math.floor(0.5*mapWidth)-(0.5*roomSize)+(currentPositionToAnalyse[0]*roomSize*2)-(roomSize))+"px";lineContainer.style.top=(Math.floor(0.5*mapWidth)-(0.5*roomSize)-(currentPositionToAnalyse[1]*roomSize*2)-(roomSize))+"px";dom_map.appendChild(lineContainer);var line=document.createElement("DIV");line.classList.add("diagonalLine");line.classList.add("downhillLine");lineContainer.appendChild(line);drawnLines.push(drawnPositions[i]+",downhill")}}};function removeArrowColorings(item,delStatus){surroundings_btn.innerHTML='SURROUNDINGS <b>(0)</b>';north_arrow.classList.remove("directionAvailable");south_arrow.classList.remove("directionAvailable");east_arrow.classList.remove("directionAvailable");west_arrow.classList.remove("directionAvailable");northwest_arrow.classList.remove("directionAvailable");northeast_arrow.classList.remove("directionAvailable");southwest_arrow.classList.remove("directionAvailable");southeast_arrow.classList.remove("directionAvailable");up_arrow.classList.remove("directionAvailable");down_arrow.classList.remove("directionAvailable");if(item!=="say nothing"){dom_scene.innerHTML+="<span class='command'> &gt GO "+item.id.toUpperCase()+"</span><br />";dom_scene.scrollTo(0,dom_scene.scrollHeight)}roomObjects=[];dom_sidePanel.style.right="-70%";document.getElementById("surroundings_btn").classList.remove("buttonActive");document.getElementById("inventory_btn").classList.remove("buttonActive");nukeHyperlinks();autoSave();header();try{definitions[room]()}catch(error){print(error)}if(delStatus!=="don't remove"){var blobbo=document.getElementById("blob");blobbo.parentElement.removeChild(blobbo)}var circle=document.createElement("DIV");circle.id="blob";var coords=room.split(",");document.getElementById("square("+coords[0]+","+coords[1]+","+coords[2]+")").appendChild(circle)};function changeMapLayer(operation){var room_array=room.split(",");preserveMap[room_array[2]]={drawnPositions:drawnPositions,drawnLines:drawnLines,allowedLines:allowedLines};room_array[2]=parseInt(room_array[2])+operation;room=room_array[0]+","+room_array[1]+","+room_array[2];if(typeof preserveMap[room_array[2]]!=='undefined'&&preserveMap[room_array[2]]!==null){drawnLines=[];allowedLines=preserveMap[room_array[2]].allowedLines;drawnPositions=preserveMap[room_array[2]].drawnPositions}else{drawnLines=[];allowedLines=[];drawnPositions=[]}drawnPositions.push(room);dom_map.innerHTML="";for(var i=0;i<drawnPositions.length;i+=1){drawSquare(drawnPositions[i].split(","))}drawLines();if(typeof preserveMap[room_array[2]]!=='undefined'&&preserveMap[room_array[2]]!==null){drawnLines=preserveMap[room_array[2]].drawnLines}dom_zCounter.innerHTML=room_array[2]};function print(string){dom_scene.innerHTML+=string+"<br /><br />";dom_scene.scrollTo(0,dom_scene.scrollHeight)};function addExits(a,b,c,m,e,f,g,h,k,l){function checkCoord(string){if(a===string||b===string||c===string||m===string||e===string||f===string||g===string||h===string||k===string||l===string){document.getElementById(string).classList.add("directionAvailable")}};checkCoord("north");checkCoord("south");checkCoord("east");checkCoord("west");checkCoord("southeast");checkCoord("southwest");checkCoord("northeast");checkCoord("northwest");checkCoord("up");checkCoord("down")};function removeExits(a,b,c,m,e,f,g,h,k,l){function checkCoord(string){if(a===string||b===string||c===string||m===string||e===string||f===string||g===string||h===string||k===string||l===string){document.getElementById(string).classList.remove("directionAvailable")}};checkCoord("north");checkCoord("south");checkCoord("east");checkCoord("west");checkCoord("southeast");checkCoord("southwest");checkCoord("northeast");checkCoord("northwest");checkCoord("up");checkCoord("down")};function addRoomObject(string){var cntr=0;for(var i=0;i<roomObjects.length;i+=1){if(roomObjects[i].name===string){roomObjects[i].count+=1;cntr+=1;break}}if(cntr===0){roomObjects.push({name:string,count:1,actions:[]});var currentCount=parseInt(surroundings_btn.innerHTML.replace('SURROUNDINGS <b>(','').replace(')</b>',''));currentCount+=1;surroundings_btn.innerHTML='SURROUNDINGS <b>('+currentCount+')</b>'}}function addRoomObjectAction(name,actionName,action){var objectExists=false;for(var i=0;i<roomObjects.length;i+=1){if(roomObjects[i].name===name){roomObjects[i].actions.push({name:actionName,action:action});objectExists=true;break}}if(objectExists===false){addRoomObject(name);addRoomObjectAction(name,actionName,action)}}function removeRoomObjectAction(name,actionName){for(var j=0;j<roomObjects.length;j+=1){if(roomObjects[j].name===name){var obj=roomObjects[j];break}}if(typeof obj!=='undefined'){for(var i=0;i<obj.actions.length;i+=1){if(obj.actions[i].name===actionName){var index=obj.actions.indexOf(obj.actions[i]);obj.actions.splice(index,1)}}}}function removeRoomObject(name){for(var i=0;i<roomObjects.length;i+=1){if(roomObjects[i].name===name&&roomObjects[i].count===1){var index=roomObjects.indexOf(roomObjects[i]);roomObjects.splice(index,1);var currentCount=parseInt(surroundings_btn.innerHTML.replace('SURROUNDINGS <b>(','').replace(')</b>',''));currentCount-=1;surroundings_btn.innerHTML='SURROUNDINGS <b>('+currentCount+')</b>'}else if(roomObjects[i].name===name&&roomObjects[i].count!==1){roomObjects[i].count-=1}}}function addInventoryObject(string){var cntr=0;for(var i=0;i<inventoryObjects.length;i+=1){if(inventoryObjects[i].name===string){inventoryObjects[i].count+=1;cntr+=1;break}}if(cntr===0){inventoryObjects.push({name:string,count:1,actions:[]});var currentCount=parseInt(inventory_btn.innerHTML.replace('INVENTORY <b>(','').replace(')</b>',''));currentCount+=1;inventory_btn.innerHTML='INVENTORY <b>('+currentCount+')</b>'}}function addInventoryObjectAction(name,actionName,action){var objectExists=false;for(var i=0;i<inventoryObjects.length;i+=1){if(inventoryObjects[i].name===name){inventoryObjects[i].actions.push({name:actionName,action:action});objectExists=true;break}}if(objectExists===false){addInventoryObject(name);addInventoryObjectAction(name,actionName,action)}}function removeInventoryObjectAction(name,actionName){for(var j=0;j<inventoryObjects.length;j+=1){if(inventoryObjects[j].name===name){var obj=inventoryObjects[j];break}}if(typeof obj!=='undefined'){for(var i=0;i<obj.actions.length;i+=1){if(obj.actions[i].name===actionName){var index=obj.actions.indexOf(obj.actions[i]);obj.actions.splice(index,1)}}}}function removeInventoryObject(name){for(var i=0;i<inventoryObjects.length;i+=1){if(inventoryObjects[i].name===name&&inventoryObjects[i].count===1){var index=inventoryObjects.indexOf(inventoryObjects[i]);inventoryObjects.splice(index,1);var currentCount=parseInt(inventory_btn.innerHTML.replace('INVENTORY <b>(','').replace(')</b>',''));currentCount-=1;inventory_btn.innerHTML='INVENTORY <b>('+currentCount+')</b>'}else if(inventoryObjects[i].name===name&&inventoryObjects[i].count!==1){inventoryObjects[i].count-=1}}}function createCollapsibleListeners(){var collapsibles=document.getElementsByClassName("collapsible");for(var i=0;i<collapsibles.length;i+=1){collapsibles[i].addEventListener("click",function(){this.classList.toggle("active");var collContent=this.nextElementSibling;if(collContent.style.maxHeight){collContent.style.maxHeight=null;this.children[0].innerHTML="＋"}else{collContent.style.maxHeight=collContent.scrollHeight+"px";this.children[0].innerHTML="－"}})}}function changeItemsInPanel(item){if(item===document.getElementById("surroundings_btn")){for(var i=0;i<roomObjects.length;i+=1){var objectsName=roomObjects[i].name.toUpperCase();dom_sidePanel.innerHTML+="<div class='collapsible'>"+objectsName+"<div class='plus'>＋</div></div>";var content=document.createElement("DIV");content.classList.add("content");dom_sidePanel.appendChild(content);for(var j=0;j<roomObjects[i].actions.length;j+=1){var option=document.createElement("DIV");option.classList.add("inCollapsible");content.appendChild(option)}}var contentBoxes=document.getElementsByClassName("content");for(var x=0;x<contentBoxes.length;x+=1){var panels=contentBoxes[x].children;for(var y=0;y<panels.length;y+=1){panels[y].roomObj=roomObjects[x];panels[y].actionsName=panels[y].roomObj.actions[y].name.toUpperCase();panels[y].innerHTML=panels[y].actionsName;panels[y].action=panels[y].roomObj.actions[y].action;panels[y].onclick=function(){dom_scene.innerHTML+="<span class='command'> &gt SURROUNDINGS -> "+this.roomObj.name.toUpperCase()+" -> "+this.actionsName+"</span><br />";dom_scene.scrollTo(0,dom_scene.scrollHeight);this.action();dom_sidePanel.style.right="-70%";document.getElementById("surroundings_btn").classList.remove("buttonActive")}}}}else{for(var i=0;i<inventoryObjects.length;i+=1){var objectsName=inventoryObjects[i].name.toUpperCase();dom_sidePanel.innerHTML+="<div class='collapsible'>"+objectsName+"<div class='plus'>＋</div></div>";var content=document.createElement("DIV");content.classList.add("content");dom_sidePanel.appendChild(content);for(var j=0;j<inventoryObjects[i].actions.length;j+=1){var option=document.createElement("DIV");option.classList.add("inCollapsible");content.appendChild(option)}}var contentBoxes=document.getElementsByClassName("content");for(var x=0;x<contentBoxes.length;x+=1){var panels=contentBoxes[x].children;for(var y=0;y<panels.length;y+=1){panels[y].inventoryObj=inventoryObjects[x];panels[y].actionsName=panels[y].inventoryObj.actions[y].name.toUpperCase();panels[y].innerHTML=panels[y].actionsName;panels[y].action=panels[y].inventoryObj.actions[y].action;panels[y].onclick=function(){dom_scene.innerHTML+="<span class='command'> &gt INVENTORY -> "+this.inventoryObj.name.toUpperCase()+" -> "+this.actionsName+"</span><br />";dom_scene.scrollTo(0,dom_scene.scrollHeight);this.action();dom_sidePanel.style.right="-70%";document.getElementById("inventory_btn").classList.remove("buttonActive")};}}}createCollapsibleListeners()};function addStat(string,symbol){var alreadyExists=false;for(var i=0;i<statistics.length;i+=1){if(statistics[i].name===string){alreadyExists=true;break}}if(alreadyExists===false){statistics.push({name:string,symbol:symbol})}}function clearConsole(){dom_scene.innerHTML=""}function clearConsole2(){dom_scene.innerHTML="";document.getElementById("statusReport").style.color="green";return "Console has been cleared!"}function updateStats(){dom_mask.style.textAlign="left";dom_mask.innerHTML="<div class='hedda'>STATISTICS</div>";var ul=document.createElement("UL");dom_mask.appendChild(ul);for(var i=0;i<statistics.length;i+=1){dom_mask.children[1].innerHTML+="<li>"+statistics[i].name.replace(/_/g," ").toUpperCase()+": "+eval("pl."+statistics[i].name)+statistics[i].symbol+"</li>"}}function showSettings(){dom_mask.style.textAlign="center";dom_mask.innerHTML="<div class='hedda'>SETTINGS</div><br>";if(ornt==="portrait"){dom_mask.innerHTML+="<div><u>Map Opacity</u></div><br><div class='slideContainer'><input type='range' step='0.1' min='0' max='1' value='"+opacity+"' id='opacitySlider' class='slider'></div><div>(This option allows you to see the map through the console window: 0 = map not visible, 1 = map fully visible.)</div><br><br>"}dom_mask.innerHTML+="<div><u>Font Size</u></div><br><div class='slideContainer'><input type='range' step='0.1' min='0.8' max='1.8' value='"+fontSize+"' id='fontSizeSlider' class='slider'></div><div>(This option lets you change the font size of text in the console.)</div><br><br>";dom_mask.innerHTML+="<div><u>Save/Load Game</u></div><br>Choose a slot: &nbsp;<select></select><br><br>";function updateDropdown(){var dropdown=document.getElementsByTagName("SELECT")[0];dropdown.innerHTML="<option>Create a new save slot...</option>";var slotsLen=saveSlots.length;for(var i=0;i<slotsLen;i+=1){dropdown.innerHTML+="<option>"+saveSlots[i]+"</option>"}}updateDropdown();dom_mask.innerHTML+="<div class='button' id='saveButton' style='margin: 0 auto; width: 9em;'>SAVE GAME</div><div>(This will save the game as it was <i>before</i> you entered the room you're currently in.)</div><br><br>";dom_mask.innerHTML+="<div class='button' id='loadButton' style='margin: 0 auto; width: 9em;'>LOAD GAME</div><div>(This will load the game.)</div><br><br>";dom_mask.innerHTML+="<div><u>Clear Console</u></div><br>";dom_mask.innerHTML+="<div class='button' id='clearButton' style='margin: 0 auto; width: 13em;'>CLEAR CONSOLE</div><div>(Game getting sluggish? This button will clear the console and speed it up again!)</div><br><br>";dom_mask.innerHTML+="<div id='statusReport'></div>";document.getElementById("saveButton").addEventListener("click",function(){document.getElementById("statusReport").innerHTML=saveGame(document.getElementsByTagName("SELECT")[0].value);updateDropdown()});document.getElementById("loadButton").addEventListener("click",function(){document.getElementById("statusReport").innerHTML=loadGame(document.getElementsByTagName("SELECT")[0].value)});document.getElementById("clearButton").addEventListener("click",function(){document.getElementById("statusReport").innerHTML=clearConsole2()});document.getElementById("fontSizeSlider").onchange=function(){fontSize=this.value;dom_scene.style.fontSize=fontSize+"em";localStorage.setItem("fontSize",fontSize)}}function removeStat(string){for(var i=0;i<statistics.length;i+=1){if(statistics[i].name===string){var index=statistics.indexOf(statistics[i]);statistics.splice(index,1)}}}function teleport(coords){var newCoords_array=coords.split(",");for(var i=0;i<newCoords_array.length;i+=1){newCoords_array[i]=parseInt(newCoords_array[i])}dom_map.style.left="calc(50% - "+((0.5*mapWidth)+(newCoords_array[0]*roomSize*2))+"px)";dom_map.style.top="calc((0.5 * (100% - 208px - 45px)) - "+((0.5*mapWidth)-(newCoords_array[1]*roomSize*2))+"px)";room=newCoords_array[0]+","+newCoords_array[1]+","+room.split(",")[2];if(newCoords_array[2]!==room.split(",")[2]){var operation=newCoords_array[2]-room.split(",")[2];changeMapLayer(operation);carryOn("don't remove")}else{carryOn("")}function carryOn(cmd){if(drawnPositions.indexOf(newCoords_array[0]+","+newCoords_array[1]+","+newCoords_array[2])===-1){drawSquare(newCoords_array);drawnPositions.push(newCoords_array[0]+","+newCoords_array[1]+","+newCoords_array[2])}room=newCoords_array[0]+","+newCoords_array[1]+","+newCoords_array[2];removeArrowColorings("say nothing",cmd)}}function hyperlink(text,axn){eval("window.hyperlink_function_"+hypcntr+" = "+axn);hypcntr+=1;return "<a href=\\"javascript:void(0)\\" class=\\"activeHyperlink\\" onclick=\\"hyperlinkClick(this, \`"+text+"\`, hyperlink_function_"+(hypcntr-1)+")\\">"+text+"</a>"}function hyperlinkClick(element,text,axn){if(element.classList.contains("activeHyperlink")){dom_scene.innerHTML+="<span class='command'> &gt "+text.toUpperCase()+"</span><br />";dom_scene.scrollTo(0,dom_scene.scrollHeight);axn()}else{dom_scene.innerHTML+="<span class='command'> &gt "+text.toUpperCase()+"</span><br />";dom_scene.scrollTo(0,dom_scene.scrollHeight);print("You can no longer do this!")}}function nukeHyperlinks(){var uno=document.getElementsByTagName("a");var dos=uno.length;for(var i=0;i<dos;i+=1){uno[i].classList.remove("activeHyperlink")}}function roomName(name){var dummy=document.getElementById('label('+room+')');if(dummy===null){document.getElementById("square("+room+")").innerHTML+="<div class='label' id='label("+room+")'>"+name+"</div>"}else{dummy.innerHTML=name}roomLabels["square("+room+")"]="<div class='label' id='label("+room+")'>"+name+"</div>"}function autoSave(){sessionStorage.setItem("invent",inventory_btn.innerHTML);sessionStorage.setItem("room",room);sessionStorage.setItem("statistics",JSON.stringify(statistics));sessionStorage.setItem("sceneText",dom_scene.innerHTML);var playerVariables=[];for(varName in window.pl){playerVariables.push({name:varName,value:window.pl[varName]})}sessionStorage.setItem("playerVariables",JSON.stringify(playerVariables));sessionStorage.setItem("roomLabels",JSON.stringify(roomLabels));sessionStorage.setItem("drawnPositions",JSON.stringify(drawnPositions));sessionStorage.setItem("drawnLines",JSON.stringify(drawnLines));sessionStorage.setItem("allowedLines",JSON.stringify(allowedLines));sessionStorage.setItem("preserveMap",JSON.stringify(preserveMap));var inventoryObjects_prepared=[];var ilen=inventoryObjects.length;for(var i=0;i<ilen;i+=1){inventoryObjects_prepared.push({name:inventoryObjects[i].name,count:inventoryObjects[i].count,actions:[]});var alen=inventoryObjects[i].actions.length;for(var j=0;j<alen;j+=1){inventoryObjects_prepared[i].actions.push({name:inventoryObjects[i].actions[j].name,action:String(inventoryObjects[i].actions[j].action)})}}sessionStorage.setItem("inventoryObjects",JSON.stringify(inventoryObjects_prepared))}function saveGame(command){if(sessionStorage.getItem("room")!==null){if(command==="Create a new save slot..."){var name=prompt("Please choose a name for the save file. Only letters are allowed. No spaces.");name=name.replace(/[^A-Za-z]+/g,"");if(name.length===0){name="Unnamed_Save"}var existsAlready=false;if(saveSlots.indexOf(name)!==-1){existsAlready=!confirm("A save slot with this name already exists. Overwrite?")}}else{name=command;var existsAlready=false}if(existsAlready===false){if(saveSlots.indexOf(name)===-1){saveSlots.push(name)}localStorage.setItem("invent$"+name,sessionStorage.invent);localStorage.setItem("saveSlots",JSON.stringify(saveSlots));localStorage.setItem("room$"+name,sessionStorage.room);localStorage.setItem("statistics$"+name,sessionStorage.statistics);localStorage.setItem("sceneText$"+name,sessionStorage.sceneText);localStorage.setItem("playerVariables$"+name,sessionStorage.playerVariables);localStorage.setItem("roomLabels$"+name,sessionStorage.roomLabels);localStorage.setItem("drawnPositions$"+name,sessionStorage.drawnPositions);localStorage.setItem("drawnLines$"+name,sessionStorage.drawnLines);localStorage.setItem("allowedLines$"+name,sessionStorage.allowedLines);localStorage.setItem("preserveMap$"+name,sessionStorage.preserveMap);localStorage.setItem("inventoryObjects$"+name,sessionStorage.inventoryObjects);document.getElementById("statusReport").style.color="green";return "Game saved successfully!"}else{document.getElementById("statusReport").style.color="#d80205";return "Save abandoned!"}}else{document.getElementById("statusReport").style.color="#d80205";return "Error: you need to make at least one move before saving!"}}function loadGame(command){if(command==="Create a new save slot..."){document.getElementById("statusReport").style.color="#d80205";return "Error: no slot selected!"}else{if(localStorage.getItem("room$"+command)!==null){room=localStorage.getItem("room$"+command);statistics=JSON.parse(localStorage.getItem("statistics$"+command));dom_scene.innerHTML=localStorage.getItem("sceneText$"+command);dom_scene.scrollTo(0,dom_scene.scrollHeight);var playerVariables=JSON.parse(localStorage.getItem("playerVariables$"+command));var plength=playerVariables.length;for(var i=0;i<plength;i+=1){if(typeof playerVariables[i].value!=="undefined"){if(typeof playerVariables[i].value==="string"){eval("pl."+playerVariables[i].name+" = \`"+playerVariables[i].value+"\`;")}else{eval("pl."+playerVariables[i].name+" = "+playerVariables[i].value+";")}}}roomLabels=JSON.parse(localStorage.getItem("roomLabels$"+command));drawnPositions=JSON.parse(localStorage.getItem("drawnPositions$"+command));allowedLines=JSON.parse(localStorage.getItem("allowedLines$"+command));preserveMap=JSON.parse(localStorage.getItem("preserveMap$"+command));drawnLines=[];var playerPosition=room.split(",");dom_map.style.left="calc(50% - "+((0.5*mapWidth)+(playerPosition[0]*roomSize*2))+"px)";dom_map.style.top="calc((0.5 * (100% - 208px - 45px)) - "+((0.5*mapWidth)-(playerPosition[1]*roomSize*2))+"px)";dom_map.innerHTML="";for(var i=0;i<drawnPositions.length;i+=1){drawSquare(drawnPositions[i].split(","))}drawLines();drawnLines=JSON.parse(localStorage.getItem("drawnLines$"+command));dom_zCounter.innerHTML=playerPosition[2];var inventoryObjects_bad=JSON.parse(localStorage.getItem("inventoryObjects$"+command));inventoryObjects=[];var funCounter=0;var xlen=inventoryObjects_bad.length;for(var i=0;i<xlen;i+=1){inventoryObjects.push({name:inventoryObjects_bad[i].name,count:inventoryObjects_bad[i].count,actions:[]});var ylen=inventoryObjects_bad[i].actions.length;for(var j=0;j<ylen;j+=1){eval("var user_function_"+funCounter+" = "+inventoryObjects_bad[i].actions[j].action+";");inventoryObjects[i].actions.push({name:inventoryObjects_bad[i].actions[j].name,action:eval("user_function_"+funCounter)});funCounter+=1}}inventory_btn.innerHTML=localStorage.getItem("invent$"+command);removeArrowColorings("say nothing","don't remove");document.getElementById("statusReport").style.color="green";return "Game loaded successfully!"}else{document.getElementById("statusReport").style.color="#d80205";return "Error: no savedata found!"}}}function killGame(){surroundings_btn.innerHTML='SURROUNDINGS <b>(0)</b>';inventory_btn.innerHTML='INVENTORY <b>(0)</b>';north_arrow.classList.remove("directionAvailable");south_arrow.classList.remove("directionAvailable");east_arrow.classList.remove("directionAvailable");west_arrow.classList.remove("directionAvailable");northwest_arrow.classList.remove("directionAvailable");northeast_arrow.classList.remove("directionAvailable");southwest_arrow.classList.remove("directionAvailable");southeast_arrow.classList.remove("directionAvailable");up_arrow.classList.remove("directionAvailable");down_arrow.classList.remove("directionAvailable");document.getElementById("surroundings_btn").classList.remove("buttonActive");document.getElementById("inventory_btn").classList.remove("buttonActive");roomObjects=[];inventoryObjects=[];nukeHyperlinks();print("<b>The game has ended.</b>");print(hyperlink("Restart Game",function(){location.reload()}))} function image(source) { document.getElementById("background").style.backgroundImage = "url(" + source + ")"; } function removeImage() { document.getElementById("background").style.backgroundImage = ''; } </script> <style> body,html{padding:0;margin:0;background-color:#caeaef;user-select:none;-moz-user-select:none;-webkit-user-select:none;color:#FFF;font-size:0.9em}html{max-width:1300px;position:relative;margin:0 auto}.active_bottom_btn{font-weight:bold;color:#000;background-color:#af5c03}#zCounter{line-height:64px;text-align:center;color:#0099b1;visibility:hidden}#container{background-color:#000;position:relative;height:100vh;overflow:hidden}#controlPanel{background-color:#000;box-sizing:border-box;height:208px;width:100%;position:absolute;bottom:45px;padding:8px;z-index:1}#controlsBox{height:calc(208px - 16px);width:calc(208px - 16px);margin-left:auto;float:left}#leftWindow{height:calc(208px - 16px);width:calc(100% - 208px + 16px - 8px);float:left;margin-right:8px}#scene{box-sizing:border-box;background-color:#AAA;color:#000;height:calc(100% - 208px - 45px - 8px);width:calc(100% - 16px);overflow-y:auto;padding:8px;position:absolute;left:8px;top:8px;scroll-behavior:smooth}.arrow{box-sizing:border-box;width:0;height:0;border-style:solid;border-color:transparent;float:left}#north{border-bottom-color:#222;border-width:calc((208px - 16px) / 3);border-top-style:none;border-left-width:calc((208px - 16px) / 6);border-right-width:calc((208px - 16px) / 6)}#west{border-right-color:#222;border-width:calc((208px - 16px) / 3);border-left-style:none;border-top-width:calc((208px - 16px) / 6);border-bottom-width:calc((208px - 16px) / 6)}#east{border-left-color:#222;border-width:calc((208px - 16px) / 3);border-right-style:none;border-top-width:calc((208px - 16px) / 6);border-bottom-width:calc((208px - 16px) / 6)}#south{border-top-color:#222;border-width:calc((208px - 16px) / 3);border-bottom-style:none;border-left-width:calc((208px - 16px) / 6);border-right-width:calc((208px - 16px) / 6)}.arrowContainer{width:calc((208px - 16px) / 3);height:calc((208px - 16px) / 3);float:left}#northwest{border-left-style:none;border-top-color:#222;border-width:calc((208px - 16px) / 6);border-bottom-style:none;margin:calc((208px - 16px) / 12) auto auto;float:none}#northeast{border-top-color:#222;border-right-style:none;border-width:calc((208px - 16px) / 6);border-bottom-style:none;margin:calc((208px - 16px) / 12) auto auto;float:none}#southwest{border-bottom-color:#222;border-left-style:none;border-width:calc((208px - 16px) / 6);border-top-style:none;margin:calc((208px - 16px) / 12) auto auto;float:none}#southeast{border-bottom-color:#222;border-right-style:none;border-width:calc((208px - 16px) / 6);border-top-style:none;margin:calc((208px - 16px) / 12) auto auto;float:none}#north.directionAvailable{border-bottom-color:#AAA}#south.directionAvailable{border-top-color:#AAA}#east.directionAvailable{border-left-color:#AAA}#west.directionAvailable{border-right-color:#AAA}#southwest.directionAvailable{border-bottom-color:#AAA}#southeast.directionAvailable{border-bottom-color:#AAA}#northeast.directionAvailable{border-top-color:#AAA}#northwest.directionAvailable{border-top-color:#AAA}.navButton.directionAvailable{background-color:#AAA}#tabs{font-weight:bold;box-sizing:border-box;width:100%;height:45px;background-color:#000;position:absolute;bottom:0;border-top-style:solid;border-width:1px;border-color:#333;color:#AAA}.tab{box-sizing:border-box;width:25%;height:100%;float:left;text-align:center;border-right-style:solid;border-width:1px;line-height:44px;border-color:#333}.button,.navButton{box-sizing:border-box;border-radius:16px;background-color:#222;color:#000;text-align:center;height:42px;margin-bottom:8px;line-height:42px;max-width:calc(208px - 16px)}.arrowContainer:hover,.button:hover,.navButton:hover,.tab:hover{cursor:pointer}.button{background-color:#0099b1}#sidePanel{height:calc(100vh - 45px);width:70%;background-color:#444;position:absolute;right:-70%;z-index:2;border-top-left-radius:16px;border-bottom-left-radius:16px;overflow-x:auto;transition:right 0.2s ease-out}.collapsible{box-sizing:border-box;background-color:#000;color:#AAA;cursor:pointer;line-height:44px;width:100%;text-align:left;padding-left:8px;padding-right:8px}.content{line-height:44px;overflow:hidden;background-color:#0099b1;max-height:0;color:#000;transition:max-height 0.2s ease-out}.plus{float:right}.inCollapsible{padding-left:8px;padding-right:8px}.inCollapsible:hover{cursor:pointer}.buttonActive{background-color:#007284}#map{position:absolute;background-color:transparent;transition:left 0.2s ease-out, top 0.2s ease-out}.mapRoom{width:64px;height:64px;box-sizing:border-box;border-style:solid;border-color:#000;border-width:4px;position:absolute;text-align:center;color:#000}.verticalLine{border-width:4px;box-sizing:border-box;width:34px;height:64px;border-right-style:solid;border-color:#000;background-color:transparent;position:absolute}.horizontalLine{border-width:4px;box-sizing:border-box;width:64px;height:34px;border-bottom-style:solid;border-color:#000;background-color:transparent;position:absolute}.uphillLineContainer{box-sizing:border-box;width:64px;height:64px;background-color:transparent;position:absolute}.diagonalLine{border-width:4px;box-sizing:border-box;width:34px;height:94px;border-right-style:solid;border-color:#000;background-color:transparent;transform-origin:32px 50%;position:absolute;bottom:calc((-94px + 64px) / 2)}.uphillLine{transform:rotate(45deg)}.downhillLine{transform:rotate(-45deg)}#mask{background-color:#000;width:100%;height:calc(100% - 45px);position:absolute;z-index:3;visibility:hidden;overflow-y:auto;box-sizing:border-box;padding:16px;text-align:center;font-size:1.2em}#shadow{position:absolute;box-sizing:border-box;background-color:transparent;height:calc(100% - 208px - 45px - 8px);width:calc(100% - 16px);border-radius:16px;left:8px;top:8px;box-shadow:0 0 0 50px #000;z-index:1;pointer-events:none}.command{color:#af5c03;font-weight:bold}.hedda{text-decoration:underline;color:#af5c03;font-size:1.5em;text-align:center;font-weight:bold}.slideContainer{width:100%}.slider{-webkit-appearance:none;appearance:none;width:calc(60%);margin:0 auto;height:10px;background:#555;outline:none}.slider::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:25px;height:25px;background:#0099b1;cursor:pointer;border-style:none}.slider::-moz-range-thumb{width:25px;height:25px;background:#0099b1;cursor:pointer;border-style:none}#statusReport{text-align:center;font-weight:bold}#blob{position:absolute;width:44px;height:44px;margin-left:6px;margin-top:6px;background-color:#af5c03;box-sizing:border-box;border-radius:32px}.label{position:absolute;text-align:center;display:block;width:56px;height:56px;z-index:1}#newPanel{position:absolute;left:0;top:0;float:left;width:calc(50% - 4px);box-sizing:border-box;padding:8px 0 8px 8px;background-color:#000;height:100%} #background{position:absolute;box-sizing:border-box;top:0;left:0;right:0;bottom:0;background-size:cover;background-position:center center;background-color:#aaa} </style> </head><body onload="onGameLoad();"> <div id="container"> <div id="sidePanel"></div> <div id="mask"></div> <div id="shadow"><div id="background"></div></div> <div id="scene"></div> <div id="map"></div> <div id="controlPanel"> <div id="leftWindow"> <div class="navButton" id="up">UP</div> <div class="navButton" id="down">DOWN</div> <div class="button" id="surroundings_btn">SURROUNDINGS <b>(0)</b></div> <div class="button" id="inventory_btn" style="margin-bottom: 0px;">INVENTORY <b>(0)</b></div> </div> <div id="controlsBox"> <div class="arrowContainer"><div class="arrow" id="northwest"></div></div> <div class="arrowContainer"><div class="arrow" id="north"></div></div> <div class="arrowContainer"><div class="arrow" id="northeast"></div></div> <div class="arrowContainer"><div class="arrow" id="west"></div></div> <div class="arrowContainer"><div id="zCounter">0</div></div> <div class="arrowContainer"><div class="arrow" id="east"></div></div> <div class="arrowContainer"><div class="arrow" id="southwest"></div></div> <div class="arrowContainer"><div class="arrow" id="south"></div></div> <div class="arrowContainer"><div class="arrow" id="southeast"></div></div> </div> </div> <div id="tabs"> <div class="tab" id="game_btn">Console</div> <div class="tab" id="map_btn">Map</div> <div class="tab" id="stats_btn">Statistics</div> <div class="tab" style="border-right-style: none;" id="settings_btn">Settings</div> </div> </div> <script><%PLACEHOLDER%></script></body></html>`;
